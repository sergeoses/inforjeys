<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–©–æ–¥–µ–Ω–Ω–∏–∫ ‚Äî Inforjeys</title>
    <!-- Fonts inspired by WordPress themes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
    :root{
      --wp-accent:#21759b; --wp-admin:#23282d; --bg:#f6f7f8; --card:#ffffff; --text:#222; --muted:#6c757d; --muted-2:#9aa0a6; --radius:8px
    }
    .dark{--bg:#0b1220; --card:#0f1724; --text:#e6eef8; --muted:#9aa4b2}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;line-height:1.6;margin:0;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}
    .container{max-width:1180px;margin:0 auto;padding:0 1rem}

    /* subtle textured background */
    body::before{content:'';position:fixed;inset:0;pointer-events:none;background-image:linear-gradient(transparent 0 60%, rgba(0,0,0,0.015) 100%);opacity:0.6}

    /* Admin bar */
    .admin-bar{background:var(--wp-admin);color:#fff;font-size:0.9rem}
    .admin-bar .container{display:flex;align-items:center;justify-content:space-between;padding:0.6rem 1rem}
    .admin-bar a{color:#fff;text-decoration:none;opacity:0.95}

    /* Header */
    .site-header{background:var(--card);border-bottom:1px solid rgba(0,0,0,0.06);position:sticky;top:32px;z-index:100}
    .site-header .container{display:flex;align-items:center;gap:1rem;padding:0.85rem 1rem}
    .site-brand{display:flex;flex-direction:column}
    .site-title{font-family:Merriweather,Georgia,serif;font-size:1.4rem;margin:0;color:var(--wp-accent);font-weight:700}
    .site-tagline{font-size:0.85rem;color:var(--muted)}

    .main-nav ul{list-style:none;margin:0;padding:0;display:flex;gap:0.5rem;align-items:center}
    .main-nav a{display:inline-block;padding:0.5rem 0.7rem;color:var(--text);text-decoration:none;border-radius:6px}
    .main-nav a:hover{background:rgba(33,117,155,0.06)}

    .actions{margin-left:auto;display:flex;gap:0.5rem;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.5rem 0.9rem;border-radius:6px;border:1px solid transparent;background:transparent;color:var(--text);cursor:pointer;font-weight:600;transition:all 180ms ease}
    .btn svg{width:16px;height:16px;opacity:0.9}
    .btn:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    .btn.primary{background:var(--wp-accent);color:#fff;border-color:var(--wp-accent)}
    .btn.ghost{background:transparent;border-color:rgba(0,0,0,0.06)}

    /* Layout */
    .layout{display:grid;grid-template-columns: 1fr 320px;gap:1.5rem;align-items:start}
    @media(max-width:980px){ .layout{grid-template-columns:1fr} }

    /* Entries */
    .entries-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem}
    .entry-card{background:var(--card);border:1px solid rgba(0,0,0,0.04);padding:1.1rem;border-radius:var(--radius);box-shadow:0 8px 24px rgba(2,6,23,0.06);transition:transform 180ms ease,box-shadow 180ms ease}
    .entry-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(2,6,23,0.08)}
    .entry-card h3{margin:0 0 0.35rem 0;font-family:Merriweather,Georgia,serif;font-size:1.05rem}
    .entry-meta{color:var(--muted-2);font-size:0.9rem;margin-bottom:0.5rem}
    .excerpt{color:var(--muted);line-height:1.5;max-height:4.5em;overflow:hidden;position:relative}
    .excerpt::after{content:'';position:absolute;right:0;bottom:0;left:0;height:2.2em;background:linear-gradient(transparent, var(--card))}
    .entry-actions{display:flex;gap:0.4rem;margin-top:0.75rem}
    .favorite-btn{background:transparent;border:0;font-size:1.15rem;cursor:pointer;color:#ffc107;padding:4px;border-radius:6px}
    .favorite-btn.inactive{opacity:0.45}
    .favorite-btn.active{color:#ffb020;transform:scale(1.05)}

    /* Sidebar */
    .sidebar{position:relative}
    .widget{background:var(--card);border:1px solid rgba(0,0,0,0.04);padding:0.9rem;border-radius:10px;margin-bottom:1rem}
    .widget h4{margin:0 0 0.5rem 0;font-size:0.95rem}
    .small{font-size:0.85rem;color:var(--muted)}

    /* Modal */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);padding:1rem;opacity:0;pointer-events:none;transition:opacity 200ms ease}
    .modal.open{opacity:1;pointer-events:auto}
    .modal-card{background:var(--card);width:100%;max-width:720px;border-radius:10px;padding:1rem;border:1px solid rgba(0,0,0,0.06);transform:translateY(-12px);transition:transform 200ms ease}
    .modal.open .modal-card{transform:translateY(0)}
    .modal-close{position:absolute;right:12px;top:12px;background:transparent;border:0;padding:6px;border-radius:6px;cursor:pointer}

    /* Toasts */
    #toast-container{position:fixed;right:16px;bottom:20px;z-index:150;display:flex;flex-direction:column;gap:0.5rem}
    .toast{background:#fff;padding:0.6rem 0.9rem;border-radius:6px;border-left:4px solid var(--wp-accent);box-shadow:0 6px 24px rgba(2,6,23,0.12);min-width:220px}
    .toast.error{border-left-color:#e35b4a}
    .toast.success{border-left-color:#28a745}
    .toast .muted{font-size:0.85rem;color:var(--muted);margin-top:0.2rem}

    .empty{color:var(--muted);padding:1rem 0;text-align:center}

    @media(max-width:540px){ .btn{padding:0.45rem 0.6rem} .site-title{font-size:1.05rem} }
    </style>
</head>"
<body>
    <div class="admin-bar">
      <div class="container">
        <div>–ü—Ä–∏–≤—ñ—Ç, <strong id="admin-name">–ì—ñ—Å—Ç—å</strong></div>
        <div style="font-size:0.9rem"><a href="#" id="dashboard-link">–ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è</a></div>
      </div>
    </div>

    <header class="site-header">
      <div class="container">
        <div class="site-brand">
          <a href="#" class="site-title">Inforjeys</a>
          <div class="site-tagline">–©–æ–¥–µ–Ω–Ω–∏–∫ ‚Äî –æ—Å–æ–±–∏—Å—Ç—ñ –∑–∞–ø–∏—Å–∏</div>
        </div>

        <nav class="main-nav" id="main-nav" aria-label="–ì–æ–ª–æ–≤–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è">
          <ul>
            <li><a href="#">–ì–æ–ª–æ–≤–Ω–∞</a></li>
            <li><a href="#">–ó–∞–ø–∏—Å–∏</a></li>
            <li><a href="#">–ü—Ä–æ —Å–∞–π—Ç</a></li>
          </ul>
        </nav>

        <div class="actions">
          <button class="btn ghost" id="export-btn" title="–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–ø–∏—Å—ñ–≤">–ï–∫—Å–ø–æ—Ä—Ç</button>
          <button class="btn ghost" id="import-btn" title="–Ü–º–ø–æ—Ä—Ç –∑–∞–ø–∏—Å—ñ–≤">–Ü–º–ø–æ—Ä—Ç</button>
          <button class="btn ghost" id="sync-btn" title="–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</button>
          <button class="btn theme-toggle" id="theme-toggle" aria-label="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">üåô</button>
          <button class="btn primary new-entry" id="open-new">–ù–æ–≤–∞ –∑–∞–ø–∏—Å</button>
          <div class="profile">
            <button class="profile-btn" id="profile-btn" aria-haspopup="true" aria-expanded="false">
              <span class="avatar" id="avatar">U</span>
            </button>
            <div class="profile-menu" id="profile-menu" role="menu">
              <div style="padding:0.5rem 0.5rem; border-bottom:1px solid rgba(0,0,0,0.04);">
                <strong id="profile-name">–ì—ñ—Å—Ç—å</strong>
                <div style="font-size:0.85rem;color:var(--muted)">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</div>
              </div>
              <button id="sign-in">–£–≤—ñ–π—Ç–∏</button>
              <button id="sign-out" style="display:none">–í–∏–π—Ç–∏</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="site-main container">
      <h1>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –≤–∞—à–æ–≥–æ —â–æ–¥–µ–Ω–Ω–∏–∫–∞</h1>
      <p class="today">–°—å–æ–≥–æ–¥–Ω—ñ: <span id="today"></span></p>

      <div class="layout">
        <section class="content">
          <div class="controls">
            <input type="search" placeholder="–ü–æ—à—É–∫ –∑–∞–ø–∏—Å—ñ–≤..." class="search" id="search" />
          </div>

          <section class="entries" id="entries-section">
            <div class="entries-grid" id="entries-grid">
              <!-- Cards -->
            </div>
            <div class="empty" id="empty-state">
              <div style="padding:1.25rem;background:linear-gradient(90deg, rgba(33,117,155,0.04), rgba(33,117,155,0.02));border-radius:10px;display:inline-block">
                <div style="font-size:1.25rem;margin-bottom:0.5rem">–©–µ –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤</div>
                <div class="small" style="margin-bottom:0.75rem">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Å.</div>
                <div><button class="btn primary" id="empty-new">–î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å</button></div>
              </div>
            </div>
          </section>
        </section>

        <aside class="sidebar" aria-label="–ë—ñ—á–Ω–∞ –ø–∞–Ω–µ–ª—å">
          <div class="widget">
            <h4>–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h4>
            <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
              <button class="btn ghost" id="export-btn-side">–ï–∫—Å–ø–æ—Ä—Ç</button>
              <button class="btn ghost" id="import-btn-side">–Ü–º–ø–æ—Ä—Ç</button>
              <button class="btn ghost" id="sync-btn-side">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</button>
              <button class="btn ghost" id="favorites-toggle">–ü–æ–∫–∞–∑–∞—Ç–∏ —É–ª—é–±–ª–µ–Ω—ñ</button>
            </div>
            <div style="margin-top:0.5rem">
              <label class="small">–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: <select id="sort-select"><option value="desc">–ù–∞–π–Ω–æ–≤—ñ—à—ñ</option><option value="asc">–ù–∞–π—Å—Ç–∞—Ä—ñ—à—ñ</option></select></label>
            </div>
            <div class="small" id="sync-status" style="margin-top:0.5rem">–°—Ç–∞—Ç—É—Å: –≥–æ—Ç–æ–≤–æ</div>
          </div>

          <div class="widget">
            <h4>–ü—Ä–æ—Ñ—ñ–ª—å</h4>
            <div class="small">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: <strong id="sidebar-user">–ì—ñ—Å—Ç—å</strong></div>
            <div style="margin-top:0.5rem"><button class="btn" id="open-profile-settings">–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button></div>
          </div>

          <div class="widget">
            <h4>–ü–æ—Ä–∞–¥–∏</h4>
            <div class="small">–¶–µ –ø–µ—Ä—à–∞ –≤–µ—Ä—Å—ñ—è. –í–∏ –º–æ–∂–µ—Ç–µ –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏/—ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ –∞–±–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–º —Å—Ö–æ–≤–∏—â–µ–º (mock).</div>
          </div>
        </aside>
      </div>
    </main>

    <!-- Toasts -->
    <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
    <input type="file" id="import-file" accept="application/json" style="display:none" />

    <!-- Modal -->
    <div class="modal" id="entry-modal" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <button class="modal-close" id="modal-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
        <h2 id="modal-title">–ù–æ–≤–∞ –∑–∞–ø–∏—Å</h2>
        <div id="draft-status" style="font-size:0.9rem;color:var(--muted);margin-top:0.25rem"></div>
        <form id="entry-form">
          <input type="hidden" id="entry-id">
          <div class="form-row">
            <input id="entry-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required />
            <input id="entry-date" type="date" />
          </div>
          <div style="margin-top:0.5rem">
            <textarea id="entry-content" placeholder="–í–∞—à –∑–∞–ø–∏—Å..." required></textarea>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn ghost" id="clear-draft" style="display:none">–û—á–∏—Å—Ç–∏—Ç–∏ —á–µ—Ä–Ω–µ—Ç–∫—É</button>
            <button type="button" class="btn ghost" id="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button type="submit" class="btn primary" id="save">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // ---- –ó–∞–≥–∞–ª—å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ ----
      const todayEl = document.getElementById('today');
      const themeToggle = document.getElementById('theme-toggle');
      const bodyEl = document.documentElement;
      const profileBtn = document.getElementById('profile-btn');
      const profileMenu = document.getElementById('profile-menu');
      const avatarEl = document.getElementById('avatar');
      const profileName = document.getElementById('profile-name');
      const signInBtn = document.getElementById('sign-in');
      const signOutBtn = document.getElementById('sign-out');

      // ---- –î–∞—Ç–∞ ----
      todayEl.textContent = new Date().toLocaleDateString('uk-UA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });



      // ---- –¢–µ–º–∞ ----
      const THEME_KEY = 'diary.theme';
      function applyTheme(theme){
        if(theme === 'dark') document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
        themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }
      const savedTheme = localStorage.getItem(THEME_KEY) || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      applyTheme(savedTheme);
      themeToggle.addEventListener('click', () => {
        const current = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        const next = current === 'dark' ? 'light' : 'dark';
        localStorage.setItem(THEME_KEY, next);
        applyTheme(next);
      });

      // ---- –ü—Ä–æ—Ñ—ñ–ª—å (–º–æ–∫) ----
      const USER_KEY = 'diary.user';
      function renderUser(){
        const user = JSON.parse(localStorage.getItem(USER_KEY));
        if(user){
          profileName.textContent = user.name;
          avatarEl.textContent = (user.name || 'U').slice(0,1).toUpperCase();
          signInBtn.style.display = 'none';
          signOutBtn.style.display = 'block';
        } else {
          profileName.textContent = '–ì—ñ—Å—Ç—å';
          avatarEl.textContent = 'G';
          signInBtn.style.display = 'block';
          signOutBtn.style.display = 'none';
        }
      }
      profileBtn.addEventListener('click', ()=>{
        const open = profileMenu.classList.toggle('open');
        profileBtn.setAttribute('aria-expanded', String(open));
      });
      signInBtn.addEventListener('click', ()=>{
        const name = prompt('–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º\'—è:', '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á');
        if(name){
          localStorage.setItem(USER_KEY, JSON.stringify({name}));
          renderUser();
          profileMenu.classList.remove('open');
        }
      });
      signOutBtn.addEventListener('click', ()=>{
        localStorage.removeItem(USER_KEY);
        renderUser();
        profileMenu.classList.remove('open');
      });
      renderUser();

      // Toaster
      const toastContainer = document.getElementById('toast-container');
      function showToast(message, type='info', timeout=3000){
        const t = document.createElement('div'); t.className = 'toast '+(type==='error'?'error': type==='success'?'success':'');
        t.innerHTML = `<div>${message}</div>`;
        toastContainer.appendChild(t);
        requestAnimationFrame(()=> t.style.opacity=1);
        setTimeout(()=>{ t.style.transition='opacity 300ms'; t.style.opacity=0; setTimeout(()=>t.remove(),300); }, timeout);
      }

      // ---- –ó–∞–ø–∏—Å–∏ ----
      const ENTRIES_KEY = 'diary.entries';
      const entriesGrid = document.getElementById('entries-grid');
      const emptyState = document.getElementById('empty-state');
      const openNewBtn = document.getElementById('open-new');
      const modal = document.getElementById('entry-modal');
      const entryForm = document.getElementById('entry-form');
      const entryId = document.getElementById('entry-id');
      const entryTitle = document.getElementById('entry-title');
      const entryContent = document.getElementById('entry-content');
      const entryDate = document.getElementById('entry-date');
      const cancelBtn = document.getElementById('cancel');
      const searchInput = document.getElementById('search');
      const EXPORT_BTN = document.getElementById('export-btn');
      const IMPORT_BTN = document.getElementById('import-btn');
      const IMPORT_FILE = document.getElementById('import-file');
      const SYNC_BTN = document.getElementById('sync-btn');
      const SYNC_STATUS = document.getElementById('sync-status');
      const DRAFT_STATUS = document.getElementById('draft-status');
      const CLEAR_DRAFT_BTN = document.getElementById('clear-draft');

      const DRAFT_KEY = 'diary.draft';
      const REMOTE_KEY = 'diary.remote';
      let draftTimer = null;

      function scheduleDraftSave(){
        if(draftTimer) clearTimeout(draftTimer);
        draftTimer = setTimeout(saveDraft, 700);
        DRAFT_STATUS.textContent = '–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è...';
      }
      function saveDraft(){
        const payload = { title: entryTitle.value, content: entryContent.value, date: entryDate.value, updated: new Date().toISOString() };
        localStorage.setItem(DRAFT_KEY, JSON.stringify(payload));
        DRAFT_STATUS.textContent = '–ß–µ—Ä–Ω–µ—Ç–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞';
        CLEAR_DRAFT_BTN.style.display = 'inline-flex';
      }
      function loadDraft(){ try{ return JSON.parse(localStorage.getItem(DRAFT_KEY)); }catch(e){return null;} }
      function clearDraft(){ localStorage.removeItem(DRAFT_KEY); DRAFT_STATUS.textContent = ''; CLEAR_DRAFT_BTN.style.display = 'none'; }

      [entryTitle, entryContent, entryDate].forEach(el=> el.addEventListener('input', ()=> scheduleDraftSave()));

      // Delegate export to unified handler (defined later)
      EXPORT_BTN && EXPORT_BTN.addEventListener('click', ()=> exportData && exportData());

      // Trigger file selector; actual import handling is attached below
      IMPORT_BTN && IMPORT_BTN.addEventListener('click', ()=> IMPORT_FILE && IMPORT_FILE.click());

      // Delegate to unified sync handler defined later
      SYNC_BTN && SYNC_BTN.addEventListener('click', ()=> doSync && doSync());

      // Clear draft handled below (duplicate removed)

      function loadEntries(){
        try{ return JSON.parse(localStorage.getItem(ENTRIES_KEY) || '[]'); } catch(e){ return []; }
      }
      function saveEntries(list){
        localStorage.setItem(ENTRIES_KEY, JSON.stringify(list));
      }

      function formatDate(iso){
        return new Date(iso).toLocaleString('uk-UA', { year:'numeric', month:'short', day:'numeric' });
      }

      function renderEntries(filter=''){
        let list = loadEntries().filter(e => (e.title + ' ' + e.content).toLowerCase().includes(filter.toLowerCase()));
        // Apply favorites filter
        if(showFavoritesOnly) list = list.filter(e => e.favorite);
        // Sorting
        if(sortOrder === 'desc') list.sort((a,b)=> new Date(b.updated||b.created) - new Date(a.updated||a.created));
        else list.sort((a,b)=> new Date(a.updated||a.created) - new Date(b.updated||b.created));

        entriesGrid.innerHTML = '';
        if(list.length === 0){
          emptyState.style.display = 'block';
          emptyState.innerHTML = showFavoritesOnly ? '<div style="padding:1.25rem;background:linear-gradient(90deg, rgba(33,117,155,0.04), rgba(33,117,155,0.02));border-radius:10px;display:inline-block"><div style="font-size:1.1rem;margin-bottom:0.5rem">–ù–µ–º–∞—î —É–ª—é–±–ª–µ–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤</div><div class="small">–°–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–¥–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ —É —É–ª—é–±–ª–µ–Ω—ñ</div></div>' : '–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ù–æ–≤–∞ –∑–∞–ø–∏—Å", —â–æ–± –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–∏–π.';
          return;
        }
        emptyState.style.display = 'none';
        for(const entry of list){
          const card = document.createElement('article');
          card.className = 'entry-card';
          const favActive = entry.favorite ? 'active' : 'inactive';
          const favSymbol = entry.favorite ? '‚òÖ' : '‚òÜ';
          card.innerHTML = `
            <div style="display:flex;align-items:flex-start;gap:0.5rem">
              <h3 style="flex:1">${escapeHtml(entry.title)}</h3>
              <button class="favorite-btn ${favActive}" data-id="${entry.id}" data-action="favorite" aria-label="–£–ª—é–±–ª–µ–Ω–µ" aria-pressed="${entry.favorite ? 'true' : 'false'}">${favSymbol}</button>
            </div>
            <div class="entry-meta">${formatDate(entry.date || entry.created)}</div>
            <div class="excerpt">${escapeHtml(entry.content)}</div>
            <div class="entry-actions">
              <button class="btn ghost" data-id="${entry.id}" data-action="edit">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
              <button class="btn ghost" data-id="${entry.id}" data-action="delete">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </div>
          `;
          entriesGrid.appendChild(card);
        }
      }

      function escapeHtml(str){
        return String(str||'').replace(/[&<>"']/g, (s)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[s]);
      }



      // modal open/close with animation and body scroll lock
      const modalCloseBtn = document.getElementById('modal-close');
      function openModal(entry){
        modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
        if(entry){
          document.getElementById('modal-title').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å';
          entryId.value = entry.id;
          entryTitle.value = entry.title;
          entryContent.value = entry.content;
          entryDate.value = entry.date ? (new Date(entry.date)).toISOString().slice(0,10) : '';
          DRAFT_STATUS.textContent = '';
          CLEAR_DRAFT_BTN.style.display = 'none';
        } else {
          document.getElementById('modal-title').textContent = '–ù–æ–≤–∞ –∑–∞–ø–∏—Å';
          entryId.value = '';
          const draft = loadDraft();
          if(draft && (draft.title || draft.content)){
            entryTitle.value = draft.title || '';
            entryContent.value = draft.content || '';
            entryDate.value = draft.date || '';
            DRAFT_STATUS.textContent = '–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–∞ —á–µ—Ä–Ω–µ—Ç–∫–∞';
            CLEAR_DRAFT_BTN.style.display = 'inline-flex';
          } else {
            entryTitle.value = '';
            entryContent.value = '';
            entryDate.value = '';
            DRAFT_STATUS.textContent = '';
            CLEAR_DRAFT_BTN.style.display = 'none';
          }
        }
      }
      function closeModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }


      const emptyNewBtn = document.getElementById('empty-new'); if(emptyNewBtn) emptyNewBtn.addEventListener('click', ()=> openModal());
      cancelBtn.addEventListener('click', ()=> closeModal());
      modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
      modalCloseBtn && modalCloseBtn.addEventListener('click', ()=> closeModal());
      // ESC to close and keyboard shortcuts
      document.addEventListener('keydown', (e)=>{ 
        if(e.key === 'Escape') { if(modal.classList.contains('open')) closeModal(); }
        // Ctrl/Cmd+N => new entry
        if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n'){
          e.preventDefault(); openModal(); showToast('–ù–æ–≤–∞ –∑–∞–ø–∏—Å','info');
        }
      });

      entryForm.addEventListener('submit', (e)=>{
        e.preventDefault();
        const list = loadEntries();
        const now = new Date().toISOString();
        if(entryId.value){
          const idx = list.findIndex(x=>x.id===entryId.value);
          if(idx>-1){
            list[idx].title = entryTitle.value;
            list[idx].content = entryContent.value;
            list[idx].date = entryDate.value ? new Date(entryDate.value).toISOString() : now;
            list[idx].updated = now;
            showToast('–ó–∞–ø–∏—Å –æ–Ω–æ–≤–ª–µ–Ω–æ','success');
          }
        } else {
          list.push({id: 'id-'+Math.random().toString(36).slice(2,9), title: entryTitle.value, content: entryContent.value, created: now, date: entryDate.value ? new Date(entryDate.value).toISOString() : now, favorite: false});
          showToast('–ó–∞–ø–∏—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ','success');
        }
        saveEntries(list);
        clearDraft();
        closeModal();
        renderEntries(searchInput.value);
      });

      entriesGrid.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        const id = btn.dataset.id;
        const action = btn.dataset.action;
        if(action === 'edit'){
          const list = loadEntries();
          openModal(list.find(x=>x.id===id));
        } else if(action === 'delete'){
          if(confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å?')){
            const list = loadEntries().filter(x=>x.id!==id);
            saveEntries(list);
            renderEntries(searchInput.value);
            showToast('–ó–∞–ø–∏—Å –≤–∏–¥–∞–ª–µ–Ω–æ','success');
          }
        } else if(action === 'favorite'){
          const list = loadEntries();
          const idx = list.findIndex(x=>x.id===id);
          if(idx > -1){
            list[idx].favorite = !list[idx].favorite;
            saveEntries(list);
            renderEntries(searchInput.value);
            showToast(list[idx].favorite ? '–î–æ–¥–∞–Ω–æ –¥–æ —É–ª—é–±–ª–µ–Ω–∏—Ö' : '–ü—Ä–∏–±—Ä–∞–Ω–æ –∑ —É–ª—é–±–ª–µ–Ω–∏—Ö','success');
          }
        }
      });

      searchInput.addEventListener('input', ()=> renderEntries(searchInput.value));

      // Export/Import
      function exportData(){
        try{
          const data = loadEntries();
          const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href = url; a.download = 'inforjeys-entries.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
          showToast('–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ','success');
        }catch(err){ showToast('–ï–∫—Å–ø–æ—Ä—Ç –Ω–µ –≤–¥–∞–≤—Å—è: '+err.message,'error'); }
      }
      EXPORT_BTN.addEventListener('click', exportData);
      const exportBtnSide = document.getElementById('export-btn-side'); if(exportBtnSide) exportBtnSide.addEventListener('click', exportData);

      IMPORT_BTN && IMPORT_BTN.addEventListener('click', ()=> IMPORT_FILE.click());
      const importBtnSide = document.getElementById('import-btn-side'); if(importBtnSide) importBtnSide.addEventListener('click', ()=> IMPORT_FILE.click());

      IMPORT_FILE.addEventListener('change', (e)=>{
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = (ev)=>{
          try{
            const imported = JSON.parse(ev.target.result);
            if(!Array.isArray(imported)) throw new Error('JSON –º–∞—î –±—É—Ç–∏ –º–∞—Å–∏–≤–æ–º –∑–∞–ø–∏—Å—ñ–≤');
            if(confirm('–ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Å–∏? OK = –ó–ê–ú–Ü–ù–ò–¢–ò; Cancel = –î–û–î–ê–¢–ò')){
              const normalized = imported.map(it=> ({...it, id: it.id || 'imp-'+Math.random().toString(36).slice(2,9)}));
              saveEntries(normalized);
            } else {
              const current = loadEntries(); const ids = new Set(current.map(x=>x.id));
              for(const it of imported){ let id = it.id || 'imp-'+Math.random().toString(36).slice(2,9); if(ids.has(id)) id = 'imp-'+Math.random().toString(36).slice(2,9); ids.add(id); current.push({...it, id}); }
              saveEntries(current);
            }
            renderEntries(searchInput.value); showToast('–Ü–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ','success');
          }catch(err){ showToast('–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É: '+err.message,'error'); }
          IMPORT_FILE.value = '';
        };
        reader.readAsText(file);
      });

      // Sync (mock)
      function doSync(){
        SYNC_BTN.disabled = true; SYNC_STATUS.textContent = '–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...';
        setTimeout(()=>{
          let remote = JSON.parse(localStorage.getItem(REMOTE_KEY) || 'null');
          if(!remote){ remote = [{id:'remote-1', title:'–ó–∞–ø–∏—Å –∑ —Å–µ—Ä–≤–µ—Ä–∞', content:'–¶–µ –∑–∞–ø–∏—Å, —â–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ', created: new Date().toISOString()}]; }
          // merge local -> remote
          const local = loadEntries();
          const remoteMap = new Map(remote.map(r=>[r.id, r]));
          for(const l of local) remoteMap.set(l.id, l);
          const newRemote = Array.from(remoteMap.values());
          localStorage.setItem(REMOTE_KEY, JSON.stringify(newRemote));
          // pull remote -> merge into local
          const localMap = new Map(loadEntries().map(r=>[r.id, r]));
          let added = 0;
          for(const r of newRemote){ if(!localMap.has(r.id)){ localMap.set(r.id, r); added++; } }
          const merged = Array.from(localMap.values()); saveEntries(merged);
          renderEntries(searchInput.value);
          showToast('–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞' + (added? `: –¥–æ–¥–∞–Ω–æ ${added} –∑–∞–ø–∏—Å—ñ–≤` : ''),'success');
          setTimeout(()=>{ SYNC_STATUS.textContent=''; SYNC_BTN.disabled=false; }, 1200);
        }, 800);
      }
      SYNC_BTN.addEventListener('click', doSync);
      const syncBtnSide = document.getElementById('sync-btn-side'); if(syncBtnSide) syncBtnSide.addEventListener('click', doSync);

      // Favorites and sorting
      let showFavoritesOnly = false;
      const favoritesToggle = document.getElementById('favorites-toggle');
      const sortSelect = document.getElementById('sort-select');
      let sortOrder = sortSelect ? sortSelect.value : 'desc';
      favoritesToggle && favoritesToggle.addEventListener('click', ()=>{
        showFavoritesOnly = !showFavoritesOnly;
        favoritesToggle.classList.toggle('active', showFavoritesOnly);
        favoritesToggle.textContent = showFavoritesOnly ? '–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ' : '–ü–æ–∫–∞–∑–∞—Ç–∏ —É–ª—é–±–ª–µ–Ω—ñ';
        showToast(showFavoritesOnly ? '–ü–æ–∫–∞–∑—É—é —Ç—ñ–ª—å–∫–∏ —É–ª—é–±–ª–µ–Ω—ñ' : '–ü–æ–∫–∞–∑—É—é –≤—Å—ñ –∑–∞–ø–∏—Å–∏');
        renderEntries(searchInput.value);
      });
      sortSelect && sortSelect.addEventListener('change', ()=>{
        sortOrder = sortSelect.value;
        renderEntries(searchInput.value);
      });

      // Open profile settings from sidebar
      const openProfileSettingsBtn = document.getElementById('open-profile-settings');
      openProfileSettingsBtn && openProfileSettingsBtn.addEventListener('click', ()=>{
        const user = JSON.parse(localStorage.getItem(USER_KEY));
        if(!user) signInBtn.click();
        else showToast('–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –ø–æ–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ','info');
      });

      CLEAR_DRAFT_BTN && CLEAR_DRAFT_BTN.addEventListener('click', ()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç–∏ —á–µ—Ä–Ω–µ—Ç–∫—É?')) { clearDraft(); showToast('–ß–µ—Ä–Ω–µ—Ç–∫–∞ –æ—á–∏—â–µ–Ω–∞'); } });

      // init
      renderEntries();

      // load draft into modal when opening new
      openNewBtn.addEventListener('click', ()=>{
        const draft = loadDraft();
        openModal();
        if(draft && (draft.title || draft.content)) showToast('–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–∞ —á–µ—Ä–Ω–µ—Ç–∫–∞','info');
      });

      // close profile menu if clicked outside
      document.addEventListener('click', (e)=>{
        if(!profileBtn.contains(e.target) && !profileMenu.contains(e.target)){
          profileMenu.classList.remove('open');
          profileBtn.setAttribute('aria-expanded','false');
        }
      });
    </script>
  </body>
</html>